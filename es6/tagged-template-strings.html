<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Tagged Template Strings</title>
  <style>
    body {
      margin: 30px;
    }

    .highlight {
      color: white;
      background-color: black;
    }

    textarea {
      margin-top: 10px;
      border-radius: 3px;
    }

    button {
      display: block;
      border: 0;
      border-radius: 3px;
      background-color: black;
      color: white;
      box-shadow: 1px 1px 3px black;
      padding: 10px;
    }

    .comment-header {
      border-bottom: 1px solid rgba(0, 0, 0, .1);
      padding: 10px 0;
      color: tomato;

    }

    .comment-body {
      display: inline-block;
      font-size: 14px;
      margin: 10px;
      border-radius: 3px;
      padding: 0 5px;
      background-color: gainsboro;
    }

  </style>
</head>
<body>
  <article>
    <form class="add-comment">
      <textarea class="comment-text" cols="60" rows="10"></textarea>
      <button >Post Comment</button>
    </form>
    <div class="comment"></div>
  </article>
  <!-- å¼•å…¥DOMPurifyï¼Œæ¥æºï¼šcdnjsèµ„æºåº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/1.0.10/purify.js"></script>
	<script>
    /*
    è½¬ä¹‰æ ‡ç­¾å°±æ˜¯åœ¨æ¨¡æ¿å­—ç¬¦ä¸²å‰é¢å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åŒ…å«äº†ä¸¤ä¸ªå‚æ•°ï¼š
    strings ä»¥æ•°ç»„çš„å½¢å¼ä¿å­˜è¢«å˜é‡åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå­—ç¬¦ä¸²æ¨¡æ¿çš„å¼€å¤´æˆ–ç»“å°¾æ˜¯å˜é‡ï¼Œé‚£ä¹ˆstringsçš„ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå€¼å°±æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚
    ...value è¡¨ç¤ºæ‰€æœ‰çš„å˜é‡
    */
    function highlight(strings, ...values) {
      // è·å–ä¸€ä¸ªå«æœ‰é«˜äº®æ ·å¼çš„æ ‡ç­¾çš„æ•°ç»„
      const highlighted = values.map(value => `
        <span class="highlight">${value}</span>
      `)

      // æŠŠstringså’Œæœ‰é«˜äº®æ ·å¼çš„æ ‡ç­¾ç»„åˆåœ¨ä¸€èµ·
      return strings.reduce((prev, curr, i) => `
        ${prev}${curr}${highlighted[i] || ''}
      `, '')
    }

    const user = 'Jay'
    let topic = 'Learn to use markdown.'
    // sentence è¿”å›highlightæ ‡ç­¾(å‡½æ•°)çš„å€¼
    let sentence = highlight`${user} has commented on your topic ${topic}`

    document.body.insertAdjacentHTML('afterbegin', sentence)  // æ’å…¥åˆ°ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ä¹‹å‰



    /*
    ä½¿ç”¨è½¬ä¹‰æ ‡ç­¾å’ŒDOMPurifyè¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ï¼Œé¿å…è¢«é»‘å®¢æ”»å‡»
    ç”¨æˆ·çš„æµ‹è¯•è¾“å…¥:
    <img src="https://s9.51cto.com/wyfs01/M00/15/7B/wKioJlIK5QzTEZzvAABqXKplFxs442.jpg-wh_651x-s_1711129743.jpg" onload="alert('Hah!You got hacked!ğŸ˜ˆ')"/>
    */
    const addCommentFrom = document.querySelector('.add-comment')
    const textarea = document.querySelector('.comment-text')
    const comment = document.querySelector('.comment')

    function sanitize(strings, ...values) {
      const dirty = strings.reduce((previous, current, i) => `
        ${previous}${current}${values[i] || ''}
      `, '')
      return DOMPurify.sanitize(dirty)
    }

    addCommentFrom.addEventListener('submit', event => {
      if(!textarea.value) {
        return
      }
      event.preventDefault()
      const newComment = textarea.value.trim()
      if(newComment) {
      // å¯ä»¥åˆ é™¤sanitizeå‡½æ•°æŸ¥çœ‹è¢«æ”»å‡»æ—¶çš„åœºæ™¯
        comment.insertAdjacentHTML('beforeend', sanitize`
          <div class="comment-header">${user}</div>
          <div class="comment-body">${textarea.value}</div>
        `) // æ’å…¥åˆ°æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ä¹‹å
      }
      textarea.value = null
    })
	</script>

</body>
</html>